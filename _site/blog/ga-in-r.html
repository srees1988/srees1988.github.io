<!doctype html>

<html class="no-js" lang="en">

<head>


	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	Sree

	Journal Theme by https://jekyllthemes.io
	Premium + free Jekyll themes for your blog or website.

	- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->


	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<!-- Page Info -->
	<link rel="shortcut icon" href="/images/favicon.png">
	<title>Google Analytics Data with R – Sree</title>
	<meta name="description" content="To automatically parse token and export Google Analytics Data with R.">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="Google Analytics Data with R – Sree">
	<meta name="twitter:description" content="To automatically parse token and export Google Analytics Data with R.">
	<meta name="twitter:image:src" content="http://localhost:4000/images/blogs/1.ga_data/ga_data1.jpg">

	<!-- Facebook OpenGraph -->
	<meta property="og:title" content="Google Analytics Data with R – Sree" />
	<meta property="og:description" content="To automatically parse token and export Google Analytics Data with R." />
	<meta property="og:image" content="http://localhost:4000/images/blogs/1.ga_data/ga_data1.jpg" />

	
	<!-- Font Embed Code -->
	<link href="https://fonts.googleapis.com/css?family=Merriweather:300,400|Muli:400,400i,600" rel="stylesheet">
	

	<!-- Styles -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/css/style.css">
	
	<!-- Icons -->
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/solid.js" integrity="sha384-GXi56ipjsBwAe6v5X4xSrVNXGOmpdJYZEEh/0/GqJ3JTHsfDsF8v0YQvZCJYAiGu" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/brands.js" integrity="sha384-0inRy4HkP0hJ038ZyfQ4vLl+F4POKbqnaUB6ewmU4dWP0ki8Q27A0VFiVRIpscvL" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/fontawesome.js" integrity="sha384-NY6PHjYLP2f+gL3uaVfqUZImmw71ArL9+Roi9o+I4+RBqArA2CfW1sJ1wkABFfPe" crossorigin="anonymous"></script>

	
	<!-- Custom Styles -->
	<style></style>
	

	
	<!-- Analytics Code -->
	
	

	
	<!-- Extra Header JS Code -->
	
	
	
</head>


<body class="loading ajax-loading" data-site-url="http://localhost:4000" data-page-url="/blog/ga-in-r">


	<header class="header">

	<div class="header-image header-image--on" style="background-image: url(/images/blogs/1.ga_data/ga_data1.jpg);"></div>
	<div class="header-image"></div>

	<div class="header-overlay"></div>

	<div class="header__content">

		
		<a href="/" class="header__title">
			Sree
		</a>
		

		<p class="header__tagline">Marketing Data Scientist</p>

		<div class="menu">
			<div class="menu__toggle js-menu-toggle">
				<div class="menu__toggle__icon"><span></span></div>
			</div>
			<div class="menu__wrap">
				<ul class="menu__list">
					
					<li class="menu__list__item">
						<a href="/" class="menu__list__item__link">Latest</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/projects/" class="menu__list__item__link">Projects</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/about" class="menu__list__item__link">About</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/contact" class="menu__list__item__link">Contact</a>
					</li>
					
				</ul>
				<ul class="socials">
	
	
	
	
	<li class="socials__item">
		<a href="https://twitter.com/srees1988" target="_blank" class="socials__item__link" title="Twitter">
			<i class="fab fa-twitter" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://github.com/srees1988" target="_blank" class="socials__item__link" title="Github">
			<i class="fab fa-github" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://linkedin.com/in/srees1988/" target="_blank" class="socials__item__link" title="Linkedin">
			<i class="fab fa-linkedin" aria-hidden="true"></i>
		</a>
	</li>
	
	
</ul>
			</div>
		</div>

	</div>

</header>


	<div class="loader"><svg width="120" height="30" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle></svg></div>

	<div class="page-loader"></div>

	
	<div class="page">

		<div class="page__content" data-page-title="Google Analytics Data with R – Sree" data-image="/images/blogs/1.ga_data/ga_data1.jpg">

			<section class="intro">

	<div class="wrap">

		<h1>Google Analytics Data with R</h1>
		<p>30 June 2019</p>

	</div>

</section>

<section class="single">

	<div class="wrap">

		<h3 id="objective">Objective</h3>

<p>To programmatically retrieve Google Analytics data for marketing analytics automation.</p>

<h3 id="details">Details</h3>

<p>Accessing Google Analytics API to retreive GA records is one of the quintessential requirements for building end-to-end marketing analytics suite. We could achieve this objective through four major steps as listed here below:</p>

<ol>
  <li>Generate Client ID and Secret Key in Google Cloud.</li>
  <li>Update .Renviron.</li>
  <li>Import relevant libraries and refresh stale tokens.</li>
  <li>Build the GA report in R.</li>
</ol>

<h5 id="step-1-generate-client-id-and-secret-key-in-google-cloud">Step 1. Generate Client ID and Secret Key in Google Cloud:</h5>

<p>Step 1.1. Create a Google Cloud Project:  Sign in to <a href="https://console.cloud.google.com">Google Cloud Console</a> and create a project.</p>

<p><img src="/images/blogs/1.ga_data/ga_data2.png" alt="" /></p>

<p>Step 1.2. Google Analytics Reporting API: Once when you have created the project, navigate to the project’s API’s and Services section and enable ‘Google Analytics Reporting API’.</p>

<div class="gallery" data-columns="1">
	<img src="/images/blogs/1.ga_data/ga_data3.png" />
	<img src="/images/blogs/1.ga_data/ga_data4.png" />
	<img src="/images/blogs/1.ga_data/ga_data5.png" />
</div>

<p>Step 1.3. Configure OAuth Consent Screen: If you are setting up Google Cloud Project for the first time, you will have to configure the OAuth Consent Screen before generating the credentials. Ensure that you choose the Analytics Reporting API’s in the project scope post entering the application name and support email in consent screen.</p>

<div class="gallery" data-columns="1">
	<img src="/images/blogs/1.ga_data/ga_data6.png" />
	<img src="/images/blogs/1.ga_data/ga_data7.png" />
	<img src="/images/blogs/1.ga_data/ga_data8.png" />
</div>

<p>Step 1.4. Create OAuth Client ID: Post configuring the OAuth consent screen, create OAuth Client ID credentials. Download the Client ID and Secret Key as a JSON file and store it in your current working directory.</p>

<div class="gallery" data-columns="1">
	<img src="/images/blogs/1.ga_data/ga_data9.png" />
	<img src="/images/blogs/1.ga_data/ga_data10.png" />
	<img src="/images/blogs/1.ga_data/ga_data11.png" />
</div>

<h5 id="step-2--update-renviron-edit-renviron-by-integrating-the-latest-google-cloud-project-credentials">Step 2.  Update .Renviron: Edit .Renviron by integrating the latest google cloud project credentials</h5>

<p>Step 2.1. Open <strong>.Renviron</strong> using the following command in R and update the parameters:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>usethis:: edit_r_environ()

</code></pre></div></div>

<p><img src="/images/blogs/1.ga_data/ga_data12.JPG" alt="" /></p>

<h5 id="step-3-ga-authentication-start-an-r-session-and-import-all-the-relevant-libraries-upfront">Step 3. GA Authentication: Start an R session and import all the relevant libraries upfront.</h5>

<p>googleAnalyticsR and googleAuthR are the must-have’s in the list. Ensure that you use ‘gar_set_client ()’ function before loading the googleAnalyticsR and googleAuthR packages. Also, point the location of the ‘refresh token’ inside the gar_auth() function.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>googleAuthR:: gar_set_client( "C:\\Users\\Sree\\gcp_client.json")

library(googleAnalyticsR)
library(googleAuthR)
library(tidyverse)
library(lubridate)
library(dplyr)

googleAuthR::gar_auth(token = "sc_ga.httr-oauth")

</code></pre></div></div>
<p>Upon executing the aforementioned command, you would be able to successully log into the Google Analytics Reporting Database via R through automated refresh tokens.</p>

<h5 id="step-4-google-analytics-reporting-api-build-the-ga-report-in-r">Step 4. Google Analytics Reporting API: Build the GA report in R</h5>

<p>Step 4.1. Get the list of views from GA:</p>

<p>Identify the entire list of views that you need from Google Analytics. Get their ViewId’s either by using the ‘ga_account_list()’ function in googleAuthR package or by identifying them from the Google Analytics itself.</p>

<p><img src="/images/blogs/1.ga_data/ga_data13.JPG" alt="" /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>my_accounts &lt;- ga_account_list()
viewId &lt;- (my_accounts$viewId)

</code></pre></div></div>

<p>Step 4.2. Build the dataset by quering Google Analytics Reporting Server:</p>

<p>For the purpose of illustration, here I have built a loop that downloads data sequentially for all the views that has been set up in Google Analytics.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ga_data_final &lt;- data.frame()


for (i in viewId) {
  ga_data_temp &lt;- 
    google_analytics(i, 
                     date_range = c(GoogleA_Start, GoogleA_End),
                     metrics = c("sessions"),
                     dimensions = c("date"
                                 ,"channelGrouping"
                                 ,"deviceCategory"
                                 ,"source"),
                     anti_sample = TRUE,
                     #slow_fetch = TRUE,
                     max = c("-1"))
  ga_data_temp$viewId &lt;- i
  ga_data_final &lt;- rbind(ga_data_final, ga_data_temp)
}

</code></pre></div></div>

<p>Step 4.3. Clean the dataset:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GA_export &lt;- 
  left_join(ga_data_final,my_accounts, by = "viewId") %&gt;%
  select(date,channelGrouping,deviceCategory,source,sessions,Country) %&gt;%
  mutate(channelGrouping_refined = if_else(
  channelGrouping == 'Organic Search','SEO',
  if_else(channelGrouping == 'Paid Search','PPC Search',
  if_else(channelGrouping == 'Display', 'PPC Display',
  if_else(channelGrouping == 'email,email','EDM',
  if_else(channelGrouping == '(Other)', 'Unspecified', channelGrouping  
  )))))) %&gt;% select(date,channelGrouping,deviceCategory,source
  ,sessions,channelGrouping_refined,Country)


rm(my_accounts,ga_data_final,ga_data_temp,i, viewId)

</code></pre></div></div>

<p>Step 4.4. Publish the dataset:</p>

<p>Here’s a snapshot of the final output from Google Analytics Reporting server.</p>

<p><img src="/images/blogs/1.ga_data/ga_data14.JPG" alt="" /></p>

<p>Finally publish the dataset with a timestamp either into a flat file or into a cloud database.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GA_data &lt;- 
  GA_export %&gt;%
  write_csv("GA_data.csv")
  
</code></pre></div></div>

<h5 id="step-5-whats-next">Step 5: What’s Next?</h5>

<p>This is just the inception of marketing analytics automation. As we could do so much more on top of this like:</p>

<ol>
  <li>Automate the R scripts on a virtual machine and store the incremental data in a cloud database.</li>
  <li>Repeat the same set of process to build an automated cross channel data lake that brings in incremental Facebook /Google /Twitter campaign Ad-level datasets.</li>
  <li>Build a BI dashboard that retrieves data from the flat file/ cloud storage to visualize an end-to-end marketing analytics suite.</li>
</ol>

<p>Feel free to reach out to me if you need any help in understanding the fundamentals of GA automation in R. Happy to share! Hope this helps:)</p>


	</div>

</section>

		</div>

	</div>


	<footer class="footer">

	<div class="footer__copyright">
	<font color="Grey">	<span>© 2019 Sree.</span></font>
		<style>.heart{color:#e25555;}</style>
                <font color="Grey">Hosted with</font> <span class="heart">❤</span> <font color="Grey">by</font> <span style="font-weight:bold"><font color="Grey">Github</font></span>
	
	</div>

</footer>



	<!-- Javascript Assets -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="/js/journal-min.js"></script>

	
	<!-- Extra Footer JS Code -->
	
	


</body>

</html>